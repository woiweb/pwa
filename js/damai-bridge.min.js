!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e["damai-bridge"]=n()}(this,function(){"use strict";function e(){var e=(new Error).stack.match(/H5Bridge\.([^ ]+)/),n=e&&e[1]||"";return Promise.reject("当前环境不支持该桥方法"+(n?"("+n+")":""))}function n(e){return"string"==typeof e.ret&&"HY_SUCCESS"===e.ret||Array.isArray(e.ret)&&"HY_SUCCESS"===e.ret[0]}function t(e){var n="";switch("string"==typeof e.ret&&(n=e.ret),n=e.ret[0]){case"HY_NO_HANDLER":return"windvane容器不存在该方法";default:return n}}var r=window.navigator.userAgent,i=/android/i.test(r),o=/iphone/i.test(r),a={ua:{IS_IN_WINDVANE:/windvane/i.test(r),IS_IN_ALIPAY:/alipay/i.test(r),IS_IN_DAMAI:/damai/i.test(r),IS_IN_TAOPIAOPIAO:/Aliapp\(DY/i.test(r),IS_WINDVANE_AND_SHOULD_USE_OLD_METHODS:i&&/v6\.2\.0(\.[0-8])?$|v6\.2\.1$/.test(r),IS_WINDVANE_AND_NO_OLD_METHODS:o&&/v6\.2\.0$/.test(r)},url:{addParam:function(e,n,t){var r=e.split("#"),i=r[1],o=r[0];return o.indexOf("?")>0?o+="&"+n+"="+encodeURIComponent(t):o+="?"+n+"="+encodeURIComponent(t),i&&(o+="#"+i),o}},fetchMtop:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return window.lib.mtop.request({api:e,v:r.v||"1.0",data:n,headers:r.headers||t.headers||{"x-hm-site":"m","x-hm-source":10188},dataType:"json",type:r.type||"GET",ecode:r.ecode||0,H5Request:!0,AntiCreep:!0,AntiFlood:!0}).then(function(e){var n=null,t=null;if((n=e.data.result?JSON.parse(e.data.result):e.data).errorCode&&"200"!==n.errorCode){var r=n.errorMsg;"MAPIE98038"===n.errorCode?r="请去订单管理完成支付":"MAPIE98003"===n.errorCode?r="您的积分还不够，无法购买哦~":"MAPIE98004"===n.errorCode?r="积分购买异常，请稍后重试":"MAPIE06009"===n.errorCode&&(r="请完成实名认证后重试"),t={code:n.errorCode,message:r}}else if(!1===n.os){var i=n.error;t=Object.assign(n,{code:"",message:i})}return t?Promise.reject(t):Promise.resolve(n)},function(e){var n=e.ret[0].replace(/^[^:]+::/,"");e.ret[0].indexOf("FAIL_SYS_TRAFFIC_LIMIT")>-1&&(n="大麦门口被挤爆啦，请稍后重试");var t={code:e.retType,message:n};return Promise.reject(t)})},cookie:{get:function(e){var n=new RegExp(e+"=([^;]*)"),t=document.cookie.match(n);return t&&t[1]?t[1]:""}},addELementToBody:function(e){document.body?document.body.appendChild(e):window.onload=function(){document.body.appendChild(e)}}},u=function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")},d=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),l=function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)},c=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n},s=function(){function n(){u(this,n)}return d(n,[{key:"getContainerInfo",value:function(){return a.ua.IS_IN_DAMAI?a.ua.IS_IN_WINDVANE?a.ua.IS_WINDVANE_AND_SHOULD_USE_OLD_METHODS?"大麦Windvane容器, 且部分方法需要走老容器实现":a.ua.IS_WINDVANE_AND_NO_OLD_METHODS?"大麦Windvane容器, 且部分方法未实现":"大麦Windvane容器":"大麦老容器":a.ua.IS_IN_ALIPAY?"支付宝":a.ua.IS_IN_TAOPIAOPIAO?"淘票票":"浏览器"}},{key:"goto",value:function(){return e()}},{key:"replaceTo",value:function(){return e()}},{key:"goBack",value:function(){return e()}},{key:"gotoRealName",value:function(){return e()}},{key:"gotoLogin",value:function(){return e()}},{key:"openAppPage",value:function(){return e()}},{key:"openWindow",value:function(){return e()}},{key:"closeWindow",value:function(){return e()}},{key:"setTitle",value:function(){return e()}},{key:"aliPay",value:function(){return e()}},{key:"wxPay",value:function(){return e()}},{key:"getLocation",value:function(){return e()}},{key:"getCityId",value:function(){return e()}},{key:"getUtdid",value:function(){return e()}},{key:"getUserCode",value:function(){return e()}},{key:"getLoginKey",value:function(){return e()}},{key:"isBottomPage",value:function(){return e()}},{key:"usertrack",value:function(){return e()}},{key:"share",value:function(){return e()}}]),n}(),f=function(e){function n(){var e,t,r,i;u(this,n);for(var o=arguments.length,a=Array(o),d=0;d<o;d++)a[d]=arguments[d];return t=r=c(this,(e=n.__proto__||Object.getPrototypeOf(n)).call.apply(e,[this].concat(a))),r.openWindow=n.prototype.goto.bind(n.prototype),r.closeWindow=n.prototype.goBack.bind(n.prototype),i=t,c(r,i)}return l(n,s),d(n,[{key:"goto",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e){if(n.params)for(var t in n.params)e=a.url.addParam(e,t,n.params[t]);return window.location.href=e,Promise.resolve()}return Promise.reject("请传递url参数")}},{key:"replaceTo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e){if(n.params)for(var t in n.params)e=a.url.addParam(e,t,n.params[t]);return window.location.replace(e),Promise.resolve()}return Promise.reject("请传递url参数")}},{key:"goBack",value:function(){return window.history.back(),Promise.resolve()}},{key:"gotoLogin",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e){return window.location.href="//m.damai.cn/damai/login/index.html?returnUrl="+encodeURIComponent(e),Promise.resolve()}return Promise.reject("请传递回调url参数")}},{key:"setTitle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e){if(window.document.title=e,/ip(hone|od|ad)/i.test(navigator.userAgent)){var n=document.createElement("iframe");n.src="/favicon.ico",n.style.display="none",n.onload=function(){setTimeout(function(){n.remove()},9)},a.addELementToBody(n)}return Promise.resolve()}return Promise.reject("请传递title参数")}},{key:"aliPay",value:function(e){var n=e.orderUrl;return n?(window.location.href=n,Promise.resolve()):Promise.reject("请传递payInfo.orderUrl参数")}},{key:"getLocation",value:function(){return a.fetchMtop("mtop.damai.wireless.other.ipLocation",{},{},{v:"1.1"}).then(function(e){return new Promise(function(n){var t={city:e.cityName};return navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){var r=e.coords,i=r.latitude,o=r.longitude;t.latitude=i||-1,t.longitude=o||-1,n(t)},function(){t.latitude=-1,t.longitude=-1,n(t)},{timeout:3e3}):(console.info("当前浏览器环境不支持获取经纬度"),t.latitude=-1,t.longitude=-1,n(t))})},function(e){return console.error("获取定位信息失败",e),Promise.reject(e)})}},{key:"getLoginKey",value:function(){return Promise.resolve(a.cookie.get("loginkey"))}}]),n}(),g=function(e){function n(){u(this,n);var e=c(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));e.replaceTo=f.prototype.replaceTo.bind(e),e.goBack=f.prototype.goBack.bind(e),e.gotoLogin=f.prototype.gotoLogin.bind(e),e.getLoginKey=f.prototype.getLoginKey.bind(e),e.bridgeReady=!1;var t=Object.getOwnPropertyNames(n.prototype),r=!0,i=!1,o=void 0;try{for(var a,d=t[Symbol.iterator]();!(r=(a=d.next()).done);r=!0){var l=a.value;"constructor"!==l&&"safeMethod"!==l&&"function"==typeof e[l]&&e.safeMethod(l)}}catch(e){i=!0,o=e}finally{try{!r&&d.return&&d.return()}finally{if(i)throw o}}return document.addEventListener("AlipayJSBridgeReady",function(){e.bridgeReady=!0},!1),e}return l(n,s),d(n,[{key:"safeMethod",value:function(e){var n=this,t=this[e];this[e]=function(){for(var r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];return new Promise(function(r){n.bridgeReady?(n[e]=t,r(n[e].apply(n,i))):setTimeout(function(){r(n[e].apply(n,i))},100)})}}},{key:"goto",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(t,r){if(e){if(e.indexOf("m.damai.cn/damai/perform/item.html?")<0)return f.prototype.goto.call(f.prototype,e,n);var i=/projectId=(\d*)/g.exec(e),o=i?i[1]:"";return o?AlipayJSBridge.call("getAppInfo",{appId:"66666753",stageCode:""},function(i){if(i.error)return f.prototype.goto.call(f.prototype,e,n);e="/build_offline/pages/perform/item.html?projectId="+o;for(var u in n.params)e=a.url.addParam(e,u,n.params[u]);AlipayJSBridge.call("startApp",{appId:"66666753",param:{url:e,appClearTop:!1,startMultApp:"YES"},closeCurrentApp:!1},t,r)},r):r("未获取到跳转详情页链接中的projectId")}return r("请传递url参数")})}},{key:"openWindow",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).params,t=void 0===n?{}:n;return new Promise(function(n,r){e&&(AlipayJSBridge.call("pushWindow",{url:e,param:t}),n()),r("请传递url参数")})}},{key:"closeWindow",value:function(){return new Promise(function(e){AlipayJSBridge.call("popWindow"),e()})}},{key:"setTitle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return new Promise(function(n,t){e&&(AlipayJSBridge.call("setTitle",{title:e}),n()),t("请传递title参数")})}},{key:"aliPay",value:function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).orderParam;return new Promise(function(n,t){e&&AlipayJSBridge.call("tradePay",{orderStr:e},function(e){"9000"===e.resultCode?n():t({code:e.resultCode,message:e.result})}),t({code:"-999",message:"请传递orderInfo.orderParam参数"})})}},{key:"getLocation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.timeout,t=void 0===n?10:n,r=e.cacheTimeout,i=void 0===r?30:r,o=e.requestType,a=void 0===o?1:o;return new Promise(function(e,n){AlipayJSBridge.call("getCurrentLocation",{bizType:"damai-bridge",timeout:t,cacheTimeout:i,requestType:a},function(t){t.error&&n(t.errorMessage),e(t)})})}}]),n}(),v=function(e){function r(){u(this,r);var e=c(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));if(e.replaceTo=f.prototype.replaceTo.bind(e),e.windvaneBridge=null,e.androidJSBridge=null,e.iosJSBridge=null,a.ua.IS_IN_WINDVANE){if(e.initWindvane()){var n=Object.getOwnPropertyNames(r.prototype),t=!0,i=!1,o=void 0;try{for(var d,l=n[Symbol.iterator]();!(t=(d=l.next()).done);t=!0){var s=d.value;"constructor"!==s&&"initWindvane"!==s&&"initJSBridge"!==s&&"safeMethod"!==s&&"callJSBridge"!==s&&"function"==typeof e[s]&&e.safeMethod(s)}}catch(e){i=!0,o=e}finally{try{!t&&l.return&&l.return()}finally{if(i)throw o}}}}return!a.ua.IS_WINDVANE_AND_SHOULD_USE_OLD_METHODS&&a.ua.IS_IN_WINDVANE||e.initJSBridge(),e}return l(r,s),d(r,[{key:"initWindvane",value:function(){var e=this;if(window.WindVane)return this.windvaneBridge=window.WindVane,!1;var n=document.createElement("script");return n.src="https://g.alicdn.com/mtb/lib-windvane/2.1.8/windvane.js",n.onload=function(){e.windvaneBridge=window.WindVane},a.addELementToBody(n),!0}},{key:"initJSBridge",value:function(){/android/i.test(navigator.userAgent)&&/damai/i.test(navigator.userAgent)&&window.JSBridge?this.androidJSBridge=window.JSBridge:window.webkit&&window.webkit.messageHandlers&&(this.iosJSBridge=window.webkit.messageHandlers)}},{key:"safeMethod",value:function(e){var n=this,t=this[e];this[e]=function(){for(var r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];return new Promise(function(r){n.windvaneBridge?(n[e]=t,r(n[e].apply(n,i))):setTimeout(function(){r(n[e].apply(n,i))},100)})}}},{key:"callJSBridge",value:function(e){for(var n=arguments.length,t=Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];if(this.androidJSBridge){if("getCityId"===e)return window.JSBridge.getCityId();if(this.androidJSBridge[e]){var i;return(i=this.androidJSBridge)[e].apply(i,t)}if("gotoRealNameThenticate"===e)return window.real_name.gotoRealNameThenticate();if("setSpecialTitle"===e){var o;return(o=window.special_title).setSpecialTitle.apply(o,t)}throw Error("未定义该桥方法 "+e)}if(this.iosJSBridge){if(this.iosJSBridge[e]){var a;return(a=this.iosJSBridge[e]).postMessage.apply(a,t)}throw Error("未定义该桥方法 "+e)}throw Error("当前环境不支持大麦APP桥协议")}},{key:"goto",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=/projectId=(\d*)/g.exec(e),r=t?t[1]:"";return r&&e.indexOf("m.damai.cn/damai/perform/item.html?")>=0?(n.params={},this.openAppPage("damai://V1/ProjectPage?id="+r,n)):f.prototype.goto.call(f.prototype,e,n)}},{key:"goBack",value:function(){var e=this;return new Promise(function(r,i){e.windvaneBridge?e.isBottomPage().then(function(o){o?e.closeWindow().then(r):e.windvaneBridge.call("DMBridge","goBack",{},function(e){if(n(e))return r();i(t(e))},function(e){i(t(e))})}).catch(i):i("当前不是WindVane环境")})}},{key:"gotoRealName",value:function(){var e=this;return new Promise(function(r,i){if(e.windvaneBridge&&!a.ua.IS_WINDVANE_AND_SHOULD_USE_OLD_METHODS){if(a.ua.IS_WINDVANE_AND_NO_OLD_METHODS)return i("当前windvane容器不支持该方法");e.windvaneBridge.call("DMBridge","gotoRealNameThenticate",{},function(e){if(n(e))return r("1"===e.realNameStatus);i(t(e))},function(e){i(t(e))})}else{window.realNameThenticate=function(e){r(e)};try{e.callJSBridge("gotoRealNameThenticate",{})}catch(e){i(e)}}})}},{key:"gotoLogin",value:function(){var e=this;return new Promise(function(n,r){e.windvaneBridge?e.windvaneBridge.call("DMBridge","gotoLogin",{},n,function(e){r(t(e))}):e.goto("asyn://needLogIn").then(n).catch(r)})}},{key:"setTitle",value:function(){var e=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return new Promise(function(i,o){if(r)if(e.windvaneBridge)e.windvaneBridge.call("DMBridge","setSpecialTitle",{title:r},function(e){n(e)&&i()},function(e){o(t(e))});else try{e.callJSBridge("setSpecialTitle",r),i()}catch(e){o(e)}else o("请传递title参数")})}},{key:"openAppPage",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(i,o){if(n){if(r.params)for(var u in r.params)n=a.url.addParam(n,u,r.params[u]);if(r.buryPoint){var d=r.buryPoint,l=d["spm-url"],c=d.pageName,s=d.alg;e.usertrack({pageUrl:c,spm:l,alg:s})}if(e.windvaneBridge&&!a.ua.IS_WINDVANE_AND_SHOULD_USE_OLD_METHODS){if(a.ua.IS_WINDVANE_AND_NO_OLD_METHODS)return o("当前windvane容器不支持该方法");e.windvaneBridge.call("DMBridge","openPage",{url:n},i,function(e){o(t(e))})}else try{e.callJSBridge("openPage",n),i()}catch(e){o(e)}}else o("请传递url参数")})}},{key:"openWindow",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(i,o){if(n){if(r.params)for(var u in r.params)n=a.url.addParam(n,u,r.params[u]);e.windvaneBridge?e.windvaneBridge.call("DMBridge","openWindow",{url:n},i,function(e){o(t(e))}):o("当前不是WindVane环境")}else o("请传递url参数")})}},{key:"closeWindow",value:function(){var e=this;return new Promise(function(n,r){e.windvaneBridge?e.windvaneBridge.call("DMBridge","closeWindow",{},n,function(e){r(t(e))}):r("当前不是WindVane环境")})}},{key:"aliPay",value:function(e){var r=this,i=e.orderId,o=e.orderParam;return new Promise(function(e,u){function d(n){"9000"===n.resultStatus?e():u("8000"===n.resultStatus?"订单处理中":"-1000"===n.resultStatus?"未安装支付宝":"6001"===n.resultStatus||"99"===n.resultStatus?"支付已被取消":n.memo||n.result)}if(r.windvaneBridge&&!a.ua.IS_WINDVANE_AND_SHOULD_USE_OLD_METHODS){if(a.ua.IS_WINDVANE_AND_NO_OLD_METHODS)return u("当前windvane容器不支持该方法");r.windvaneBridge.call("DMBridge","alipay",{orderId:i,payParam:o,jsCallBack:"AliPayJsBridgeCallback"},function(e){if(n(e))return void 0!==e.resultStatus?d(e):u("未返回支付结果");u(t(e))},function(e){u(t(e))})}else{window.AliPayJsBridgeCallback=d;try{r.callJSBridge("alipay",{orderId:i,payParam:o,jsCallBack:"AliPayJsBridgeCallback"})}catch(e){u(e)}}})}},{key:"wxPay",value:function(e){var r=this,i=e.orderId,o=e.orderParam;return new Promise(function(e,u){function d(n){0===n.errCode?e():u(-1e3===n.errCode||-1001===n.errCode?"未安装微信或版本过低":-1===n.errCode?"支付失败":-2===n.errCode?"支付已被取消":n.errStr)}if(r.windvaneBridge&&!a.ua.IS_WINDVANE_AND_SHOULD_USE_OLD_METHODS){if(a.ua.IS_WINDVANE_AND_NO_OLD_METHODS)return u("当前windvane容器不支持该方法");r.windvaneBridge.call("DMBridge","wxpay",{orderId:i,payParam:o},function(e){if(n(e))return d(e);u(t(e))},function(e){u(t(e))})}else{window.WxPayJsBridgeCallback=d;try{r.callJSBridge("wxpay",{orderId:i,payParam:o,jsCallBack:"WxPayJsBridgeCallback"})}catch(e){u(e)}}})}},{key:"getCityId",value:function(){var e=this;return new Promise(function(r,i){if(e.windvaneBridge&&!a.ua.IS_WINDVANE_AND_SHOULD_USE_OLD_METHODS){if(a.ua.IS_WINDVANE_AND_NO_OLD_METHODS)return i("当前windvane容器不支持该方法");e.windvaneBridge.call("DMBridge","getCityId",{},function(e){if(n(e))return r(e.cityid);i(t(e))},function(e){i(t(e))})}else{window.receiveCityId=function(e){r(e)};try{var o=e.callJSBridge("getCityId",{});e.androidJSBridge&&r(o)}catch(e){i(e)}}})}},{key:"getLocation",value:function(){var e=this;return new Promise(function(r,i){e.windvaneBridge?e.windvaneBridge.call("WVLocation","getLocation",{enableHighAcuracy:!0},function(e){if(n(e))return r(e.coords);i(t(e))},function(e){i(t(e))}):i("当前不是WindVane环境")})}},{key:"getUtdid",value:function(){var e=this;return new Promise(function(r,i){e.windvaneBridge?e.windvaneBridge.call("DMBridge","getUtdid",{},function(e){if(n(e))return r(e.utdid);i(t(e))},function(e){i(t(e))}):i("当前不是WindVane环境")})}},{key:"getUserCode",value:function(){var e=this;return new Promise(function(r,i){e.windvaneBridge?e.windvaneBridge.call("DMBridge","getUserCode",{},function(e){if(n(e))return r(e.usercode);i(t(e))},function(e){i(t(e))}):i("当前不是WindVane环境")})}},{key:"getLoginKey",value:function(){var e=this;return new Promise(function(r,i){e.windvaneBridge?e.windvaneBridge.call("DMBridge","getLoginkey",{},function(e){if(n(e))return r(e.loginkey);i(t(e))},function(e){i(t(e))}):i("当前不是WindVane环境")})}},{key:"isBottomPage",value:function(){var e=this;return new Promise(function(r,i){e.windvaneBridge?e.windvaneBridge.call("DMBridge","isBottomPage",{},function(e){if(n(e))return r(e.isbottompage);i(t(e))},function(e){i(t(e))}):i("当前不是WindVane环境")})}},{key:"usertrack",value:function(e){var r=this,i=e.pageUrl,o=void 0===i?window.location.href:i,a=e.spm,u=void 0===a?"0.0.0.0":a,d=e.alg,l=void 0===d?"":d;return new Promise(function(e,i){r.windvaneBridge?r.windvaneBridge.call("DMBridge","usertrack",{pageName:o,"spm-url":u,alg:l},function(r){if(n(r))return e();i(t(r))},function(e){i(t(e))}):i("当前不是WindVane环境")})}},{key:"share",value:function(e){var r=this,i=e.title,o=void 0===i?"":i,a=e.description,u=void 0===a?"":a,d=e.image,l=void 0===d?"":d,c=e.url,s=void 0===c?"":c;return new Promise(function(e,i){r.windvaneBridge?r.windvaneBridge.call("DMBridge","share",{title:o,description:u,image:l,url:s},function(r){if(n(r))return e();i(t(r))},function(e){i(t(e))}):i("当前不是WindVane环境")})}}]),r}(),p=function(e){function n(){return u(this,n),c(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return l(n,g),d(n,[{key:"getLocation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.timeout,t=void 0===n?10:n,r=e.cacheTimeout,i=void 0===r?30:r,o=e.requestType,a=void 0===o?1:o;return new Promise(function(e,n){AlipayJSBridge.call("getLocation",{timeout:t,cacheTimeout:i,requestType:a},function(t){t.error&&n(t),t.city?e(t):f.prototype.getLocation().then(function(n){t.city=n.city,e(t)})})})}}]),n}(),y=new f;a.ua.IS_IN_ALIPAY&&(y=new g),a.ua.IS_IN_DAMAI&&(y=new v),a.ua.IS_IN_TAOPIAOPIAO&&(y=new p);return y});